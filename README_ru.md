Ansible Role: 1C:Enterprise server
==================================

Роль Ansible для установки 64-битной версии сервера 1С:Предприятия и сопутствующих пакетов в Linux.

Данная роль предполагает, что Вы каким-то образом разместили легально полученные официальные пакеты в локальную директорию ФС целевого хоста. Вы можете загрузить необходимые пакеты с releases.1c.ru при наличии действующих лицензий на сервер и платформу 1С:Предприятие, а также подписки на ИТС (подробнее см. лецензионное соглашение на сервер 1С).

Данная роль устанавливает драйвер ключей HASP в виде готового пакета из [репозитория EterSoft](http://ftp.etersoft.ru/pub/Etersoft/HASP/stable/). Вы можете отключить данное поведение, если хотите установить драйвер иным способом.

Сервер 1С требует установки набора шрифтов [Microsoft Core fonts for the Web](https://en.wikipedia.org/wiki/Core_fonts_for_the_Web), лицензия на которые запрещает распространение в перепакованном виде. На Debian-подобных системах существует пакет `ttf-mscorefonts-installer`, загружающий оригинальные дистрибутивы шрифтов и регистрирующий шрифты в системе. Для RHEL существует аналогичный сторонний [пакет](https://sourceforge.net/projects/mscorefonts2/), зависящий от `cabextract` из репозитория EPEL.

В RHEL данная роль по умолчанию переводит SELinux в режим `permissive`, чтобы избежать проблем, связанных с отсутствием официальных политик SELinux для сервера 1С.

Зависимости
-----------

Python, Ansible >= 2.9

Переменные
----------

|Название|Значение по умолчанию|Описание|
|-|-|-|
|`onec_version`|-|Первые 3 числа строки версии сервера 1С в формате `8.3.XX`. Это обязательный арегумент.|
|`onec_release`|-|Последнее число строки версии сервера 1С в формате `XXXX`. Это обязательный арегумент.|
|`onec_packages_dir`|-|Путь к локальной директории с пакетами компонентов сервера 1С. Названия файлов должны быть сохранены. Это обязательный арегумент.|
|`onec_server_components`|`[common, server, ws]`|Список компонентов сервера 1С для установки: `common`, `common-nls`, `server`, `server-nls`, `ws`, `ws-nls`, `crs`. Пакеты с суффиксом `*-nls` добвляют поддержку локализации.|
|`onec_install_haspd`|`True`|Включает установку драйвера HASP.|
|`onec_install_mscorefonts`|`True`|Включает установку набора шрифтов Microsoft Core fonts.|
|`onec_selinux_state`|`permissive`|Состояние SELinux. Допустимые значения: `enforcing`, `permissive`, `disabled`.|
|`onec_service_state`|`started`|Желаемое состояние службы сервера 1С.|
|`onec_service_enabled`|`True`|Включает запуск службы сервера 1С при загрузке системы.|

Зависимости
-----------

Отсутствуют.

Поддерживаемые дистрибутивы
---------------------------

* RHEL 7

Пример плейбука
---------------

Установка сервера версии `8.3.16.1814` из локальной директории `/mnt/smb/1c`:

```yaml
---
- hosts: all
  become: yes
  vars:
    onec_version: "8.3.16"
    onec_release: "1814"
    onec_packages_dir: "/mnt/smb/1c"

  roles:
    - role: wietmann.onec_server
```

Лицензия
--------

SPDX:MIT  
Полный текст лицензии размещен в файле [LICENSE](LICENSE).

Информация об авторе
--------------------

Данная роль была написана Дмитрием Даниловым в 2021 году.
